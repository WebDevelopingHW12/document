#### 项目地址[github](https://github.com/WebDevelopingHW12)这次作业我主要负责前端的编写，第一次用Vue编写不太习惯，用了很多时间学习，这次只实现了基本功能，页面较为简洁，没有花很多心思去美化页面，但是学到了很多东西，希望有时间的时候可以继续改进#### 功能需求* 用户注册* 用户登录* 游客模式* 根据输入信息结果查询* 返回查找信息（不同用户模式权限不同）#### 代码实现**1. 用户注册**输入用户名和密码进行注册。用户可能注册成功，也可能注册失败，当新用户注册失败时，后端服务器会发送一个错误消息到前端并由前端通知用户。当注册成功后，系统默认会跳转到登录界面，进行用户的登录操作。```js<template>  <div id="signup">    <p>      <input id="username" type="text" placeholder="用户名" v-model="usr"></input>    </p>    <p>      <input id="password" type="text" placeholder="密码" v-model="psw"></input>    </p>    <p>      <button v-on:click="post()">SIGN UP</button>    </p>    <p>      <router-link to="/">Back</router-link>    </p>  </div></template><script>export default {  name: 'Signup',  data: function(){    return {      usr: "",      psw: ""    };  },  methods: {    post: function() {      this.$http.post("http://localhost:8080/register",         {          username:this.usr,           password:this.psw        },        {          withCredentials:true        }        ).then(        function(res) {          if(res.ok){            if(res.data == "Create a account\n") {              this.$router.push({path:'/'});            }            else{              alert(res.data);            }          }        },        function(res) {          alert(res.data);        });    }  }}</script>```**2. 用户登录**向服务端发送一个post请求，假如用户成功登陆，那么后端服务器将返回一个**token**用于后续操作的身份验证ID，前端服务器使用**cookies**保存此ID，并跳转至查找界面。```js <div id="login">    <p>      <input id="username" type="text" placeholder="用户名" v-model="usr"></input>    </p>    <p>      <input id="password" type="password" placeholder="密码" v-model="psw"></input>    </p>    <p>      <button v-on:click="post">SIGN IN</button>    </p>    <p>      <a href="#/Search" v-on:click="guessMode()">Sign in as guess</a>    </p>    <p>      <router-link to="/Signup">Sign up</router-link>    </p>  </div></template><script>export default {  name: 'Signin',  data: function() {    return {      usr: "",      psw: ""    };  },  methods: {    post: function() {      this.$http.post("http://localhost:8080/login",         {          username:this.usr,           password:this.psw        },        {          withCredentials:true        }        ).then(        function(res) {          if(res.ok) {            var strContent = JSON.stringify(res.data);            var jsonContent = JSON.parse(strContent);            //console.log("token:",jsonContent["token"]);            $cookies.set("LogInUser", jsonContent["token"]);            this.$router.push({path:"/Search"});          }          else {            alert("Error: Sign in error!");          }        },        function() {          alert("error");        });    },    guessMode: function() {      $cookies.set("LogInUser", "guest");    }  }}</script>```**3. 游客模式**可使用游客模式浏览查询代码实现时，将前面提到的前端服务器的**cookies**保存名为**“guest”**的特殊值，用于区分两种模式，然后跳过登陆操作直接跳转至查找界面。**4. 信息查询**```jstemplate>  <div id="example-1">    <div id="title">      <p>        <router-link to="/">Sign in</router-link>      </p>      <p>        <router-link to="/Signup">Sign up</router-link>      </p>    </div>    <div>      <button id="prev" v-on:click="prevPage()">prev</button>      <input id="search" placeholder="搜索" v-model="content"></input>      <button v-on:click="get()">Search</button>      <button id="next" v-on:click="nextPage()">next</button>    </div>    <div id="con">      <textarea v-model="msg" rows="30" cols="100"></textarea>    </div>  </div></template><script>export default {  name: 'Search',  data: function() {    return {      msg: "",      content: "",      pages: 1,      contentTag: "",      currentPage: 1    };  },```这部分分为三个模块：* 对用户输入信息的合法性进行判断：约束用户的输入格式```js   methods: {    get: function() {      var flag = /^([a-z]{1,10}((\/[0-9]*)|(\/\?page\=\d)))?$/.test(this.content);      if(!flag) {        alert("input error");        return;      }```* 向后端服务器请求相关查找内容：模仿swapi的查询命令，向后端服务器发送GET请求，得到后端的服务器发回来的消息后，以JSON的格式进行格式化并输出到屏幕上```js      this.$http.get("http://localhost:8080/api/" + this.content).then(        function(res) {          if(res.ok) {            this.msg = JSON.stringify(res.data, null, 4);          }        }, function() {          alert("error");        });```* 向后端服务器查询相关内容的总条目数：根据用户查询的类别获取条目的总数，以每页5个条目的数量分成若干页，而后前端服务器可以根据总页数以及当前用户所在的页码判断是否还有剩余内容可以查询。```js   if(this.content != ""){        this.getPages();      }    }```**5. 分页查询**此处以向后翻页为例。* 首先判断后翻一页是否超过了总页数的限制，假如超过了，那么只能显示最后一页的内容；否则，显示下一页的内容。然后更新当前用户所在的页码。* 然后向后端服务器发送请求，等待后端服务器发回相关内容。当成功接收到后端服务器发回的信息后，将相关内容显示；否则，输出获取内容失败的信息。```js// Search.vuenextPage: function() {  var nowP = this.currentPage+1 <= this.pages? this.currentPage+1 : this.pages;  this.currentPage = nowP;  this.$http.get("http://localhost:8080/api/" + this.contentTag + "/?page=" + nowP).then(    function(res) {      this.msg = JSON.stringify(res.data, null, 4);      console.log("Page: ", this.currentPage, "/", this.pages);    }, function() {      alert("Error: no next page!");    });}```**6. 权限查询**这里的实现主要使用了Vue自带的拦截器的功能。每当前端服务器向后端服务器发送请求时，假如前端存储的cookies的值不为“guest”，那么证明当前正在使用的用户是**注册用户**，那么在报文头部加一个Authorization的键值对，用于实现jwt的token验证服务，服务器的jwt通过解析这个键值对确认用户是否有权限获取受限内容。若成功，返回相应内容；否则，返回错误信息。```js// main.jsVue.http.interceptors.push((request, next)=>{    var jwtToken = $cookies.get("LogInUser");    if(jwtToken != "guest"){      request.headers.set("Authorization", 'Bearer ' + $cookies.get("LogInUser"));    }    next((response)=>{      return response;    });});```#### 程序运行**1. 注册**![在这里插入图片描述](https://img-blog.csdnimg.cn/20191209225008652.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1ZpY2t5aWlpaWlp,size_16,color_FFFFFF,t_70) 注册失败![在这里插入图片描述](https://img-blog.csdnimg.cn/20191209225042696.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1ZpY2t5aWlpaWlp,size_16,color_FFFFFF,t_70)**2. 用户登录**![在这里插入图片描述](https://img-blog.csdnimg.cn/20191209225147188.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1ZpY2t5aWlpaWlp,size_16,color_FFFFFF,t_70)**3. 查询界面**![在这里插入图片描述](https://img-blog.csdnimg.cn/20191209225239686.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1ZpY2t5aWlpaWlp,size_16,color_FFFFFF,t_70)**4. 受限查询*** 查询成功（注册用户访问/api/）![在这里插入图片描述](https://img-blog.csdnimg.cn/20191209225415104.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1ZpY2t5aWlpaWlp,size_16,color_FFFFFF,t_70)* 查询失败（游客模式访问/api/）![在这里插入图片描述](https://img-blog.csdnimg.cn/20191209225431357.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1ZpY2t5aWlpaWlp,size_16,color_FFFFFF,t_70)